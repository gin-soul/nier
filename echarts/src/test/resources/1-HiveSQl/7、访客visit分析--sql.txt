--  回头/单次访客统计


select remote_addr ,count(remote_addr) ipcount
from  ods_click_stream_visit
group by remote_addr
having ipcount > 1 




查询今日所有回头访客及其访问次数。


drop table dw_user_returning;
create table dw_user_returning(
day string,
remote_addr string,
acc_cnt string)
partitioned by (datestr string);

insert overwrite table dw_user_returning partition(datestr='20130918')
select tmp.day,tmp.remote_addr,tmp.acc_cnt
from
(select '20130918' as day,remote_addr,count(session) as acc_cnt from ods_click_stream_visit 
group by remote_addr) tmp
where tmp.acc_cnt>1;



------------------------------------------------------------------------------------
-- 人均访问频次,使用所有的独立访问的人，即独立的session个数除以所有的去重IP即可



-- 人均访问的频次，频次表示我们来了多少个session
--  次数都是使用session来进行区分，一个session就是表示一次
select count(session)/count(distinct remote_addr) from ods_click_stream_visit where datestr='20130918';



select count(1) 
from ods_click_stream_visit
where datestr ='20130918'


-- 人均页面浏览量，所有的页面点击次数累加除以所有的独立去重IP总和即可
select sum(pagevisits)/count(distinct remote_addr) from ods_click_stream_visit where datestr='20130918';













